var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function s(e){e.forEach(t)}function o(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(t,n,s){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const s=t.subscribe(...n);return s.unsubscribe?()=>s.unsubscribe():s}(n,s))}function i(e){return null==e?"":e}function a(e,t){e.appendChild(t)}function l(e){e.parentNode.removeChild(e)}function d(e){return document.createElement(e)}function u(){return e=" ",document.createTextNode(e);var e}function p(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function h(e,t,n,s){e.style.setProperty(t,n,s?"important":"")}let f;function g(e){f=e}function m(e){(function(){if(!f)throw new Error("Function called outside component initialization");return f})().$$.on_mount.push(e)}const k=[],b=[],v=[],y=[],w=Promise.resolve();let x=!1;function $(e){v.push(e)}let j=!1;const C=new Set;function T(){if(!j){j=!0;do{for(let e=0;e<k.length;e+=1){const t=k[e];g(t),_(t.$$)}for(g(null),k.length=0;b.length;)b.pop()();for(let e=0;e<v.length;e+=1){const t=v[e];C.has(t)||(C.add(t),t())}v.length=0}while(k.length);for(;y.length;)y.pop()();x=!1,j=!1,C.clear()}}function _(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach($)}}const L=new Set;function E(e,t){-1===e.$$.dirty[0]&&(k.push(e),x||(x=!0,w.then(T)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function M(r,c,i,a,d,u,p,h=[-1]){const m=f;g(r);const k=r.$$={fragment:null,ctx:null,props:u,update:e,not_equal:d,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(c.context||(m?m.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:c.target||m.$$.root};p&&p(k.root);let b=!1;if(k.ctx=i?i(r,c.props||{},((e,t,...n)=>{const s=n.length?n[0]:t;return k.ctx&&d(k.ctx[e],k.ctx[e]=s)&&(!k.skip_bound&&k.bound[e]&&k.bound[e](s),b&&E(r,e)),t})):[],k.update(),b=!0,s(k.before_update),k.fragment=!!a&&a(k.ctx),c.target){if(c.hydrate){const e=function(e){return Array.from(e.childNodes)}(c.target);k.fragment&&k.fragment.l(e),e.forEach(l)}else k.fragment&&k.fragment.c();c.intro&&((v=r.$$.fragment)&&v.i&&(L.delete(v),v.i(y))),function(e,n,r,c){const{fragment:i,on_mount:a,on_destroy:l,after_update:d}=e.$$;i&&i.m(n,r),c||$((()=>{const n=a.map(t).filter(o);l?l.push(...n):s(n),e.$$.on_mount=[]})),d.forEach($)}(r,c.target,c.anchor,c.customElement),T()}var v,y;g(m)}const K=[];function F(){return"ontouchend"in window?"touchstart":"click"}function H(e,t){return Math.abs(t[0]-t[1])>e?Math.abs(t[0]-t[1]):e}function S(e,t){return Math.abs(t[0]-t[1])+e}function A(e){if(1==e.length)return[.5];const t=Math.min(...e),n=Math.max(...e)-t;return e.map((e=>(e-t)/n))}function D(){this.removeListener(),this.fire("recordDone",this.knock)}function z(){this.removeListener(),this.fire("guardDone",this.knock)}const I=function(e,t={}){let n,s=Object.assign({defaultTimeout:1500},t),o={};return{knock:[],maxThreshold:100.03,totalThreshold:100.05,setFinisher:function(e){this.finisher=e},start:function(){this.knock=[],this.handler=this.handleKnock.bind(this),e.addEventListener(F(),this.handler)},handleKnock:function(e){this.fire("knock",e),this.knock.push(e.timeStamp),this.knock.last=e.timeStamp,this.fire("knockChanged",this.knock),n&&(n=clearTimeout(n)),n=setTimeout(this.finish.bind(this),s.defaultTimeout)},finish:function(){n=clearTimeout(n),this.finisher()},removeListener:function(){e.removeEventListener(F(),this.handler)},fire:function(e,t){o[e]&&o[e].forEach((e=>e(t)))},getKnock:function(){return this.knock},setKnock:function(e){this.knock=e},listen:function(e,t){o[e]||(o[e]=[]),o[e].push(t)},test:function(e){if(this.knock.length!=e.length)return!1;let t=A(this.knock),n=A(e),s=t.map(((e,t)=>[e,n[t]])),o=s.reduce(H,0),r=s.reduce(S,0);return o<this.maxThreshold&&r<this.totalThreshold},stop:function(){this.removeListener()}}},P=function(e,t){let n=I(e,t);return n.setFinisher(D.bind(n)),n},O=function(e,t){let n=I(e,t);return n.setFinisher(z.bind(n)),n},q=function(e,t){let n,s=Object.assign({width:500,height:50,horizontalPadding:20,knockHeight:10,knockWidth:20,bgColor:"#EFEFEF",fgColor:"#AFAFAF",knockColor:"#9F9F9F"},t),o=[],r=[];function c(e,t){let n=document.createElement(e);for(const[e,s]of Object.entries(t))n.setAttribute(e,s);return n}return{drawContainer:function(){n=c("div",{class:"prohibition-container"});const t=c("div",{class:"prohibition-spine"});return n.appendChild(t),e.appendChild(n),n},updateKnock:function(e){console.log("updateKnock",e);let t=r.length;if(e.length>t)for(let s=t;s<e.length;s++){let e=c("div",{class:"prohibition-knock"});r.push(e),n.appendChild(e)}else if(e.length<t)for(;e.length!=r.length;)n.removeChild(r.pop());o=e,A(o).forEach(((e,t)=>{setTimeout((function(){let n=Math.max(s.horizontalPadding,e*(s.width-s.horizontalPadding-s.knockWidth))+"px";r[t].style.left=n,r[t].style.opacity=1}),1)}))}}};function W(t){let n,s,o,r,c,f,g,m,k,b,v,y,w,x,$,j,C,T,_,L,E,M,K,F,H,S,A,D,z,I,P,O,q,W,G,B,N,Y,R,J,Q,U,V,X,Z,ee,te,ne,se,oe,re,ce,ie,ae,le,de,ue,pe,he,fe,ge,me,ke,be,ve,ye,we,xe,$e,je,Ce,Te,_e,Le,Ee,Me;return{c(){n=d("main"),s=d("div"),o=d("div"),o.innerHTML='<h1 class="svelte-1u11mpd">Prohibition</h1> \n    <p class="subhead svelte-1u11mpd">Secret Knock Authentication</p>',r=u(),c=d("div"),f=d("div"),g=d("div"),m=d("div"),k=u(),b=d("div"),v=d("div"),y=u(),w=d("div"),w.innerHTML='<div class="eye left svelte-1u11mpd"><div class="ball svelte-1u11mpd"></div></div> \n            <div class="brow left svelte-1u11mpd"></div> \n            <div class="eye right svelte-1u11mpd"><div class="ball svelte-1u11mpd"></div></div> \n            <div class="brow right svelte-1u11mpd"></div> \n            <div id="slat" class="checking svelte-1u11mpd"></div>',$=u(),j=d("span"),j.textContent="Scram!",C=d("span"),C.textContent="Come in.",T=u(),_=d("div"),L=d("label"),E=d("input"),M=u(),K=d("div"),F=u(),H=d("span"),H.textContent="rec",S=u(),A=d("div"),A.innerHTML='<div id="recorded-knock"></div>',D=u(),z=d("div"),z.innerHTML='<div id="recording-knock"></div> \n      <p class="caption svelte-1u11mpd">knock on the door to record your own secret knock</p>',I=u(),P=d("h2"),P.textContent="What is this?",O=u(),q=d("p"),q.textContent='Prohibition is a javascript library providing "secret knock" authentication.',W=u(),G=d("p"),G.textContent="It allows you to 'record' secret knocks (taps and clicks) and then test knocks against the recording.",B=u(),N=d("p"),N.textContent="You can supply a callback that is told if knock succeeded or not.",Y=u(),R=d("p"),R.textContent="You can use it wire up a fun—but very insecure—authentication system.",J=u(),Q=d("h2"),Q.textContent="Who is this for?",U=u(),V=d("p"),V.textContent="Me and maybe someone creating a website for a speakeasy? Might be good for hiding easter eggs.",X=u(),Z=d("h2"),Z.textContent="How do I use it?",ee=u(),te=d("p"),te.textContent="If you really want to, download and import the codes.",ne=u(),se=d("p"),se.textContent="A secret knock is just an array of timestamps (more on this below).",oe=u(),re=d("pre"),re.innerHTML='<span class="hljs-keyword" style="color: rgb(203, 120, 50);">let</span> <span class="hljs-attr">secretKnock</span> = [ <span class="hljs-number" style="color: rgb(104, 150, 186);">2452</span>, <span class="hljs-number" style="color: rgb(104, 150, 186);">2889</span>, <span class="hljs-number" style="color: rgb(104, 150, 186);">3177</span>, <span class="hljs-number" style="color: rgb(104, 150, 186);">3346</span>, <span class="hljs-number" style="color: rgb(104, 150, 186);">3782</span>, <span class="hljs-number" style="color: rgb(104, 150, 186);">4697</span>, <span class="hljs-number" style="color: rgb(104, 150, 186);">5163</span> ];',ce=u(),ie=d("p"),ie.innerHTML='Make a &quot;Guard&quot; by passing a DOM element to <span class="code svelte-1u11mpd">getGuard</span> and start it.',ae=u(),le=d("pre"),le.innerHTML='<span class="hljs-keyword" style="color: rgb(203, 120, 50);">let</span> <span class="hljs-attr">door</span> = document.querySelector(&#39;<span class="hljs-comment" style="color: rgb(127, 127, 127);">#door&#39;)</span>\n<span class="hljs-keyword" style="color: rgb(203, 120, 50);">let</span> <span class="hljs-attr">guard</span> = Prohibition.getGuard(\nguard.start()',de=u(),ue=d("p"),ue.innerHTML='This element will now listen to knocks. If enough time passes, a <span class="code svelte-1u11mpd">guardDone</span> event will fire. Listen to it and perform a test:',pe=u(),he=d("pre"),he.innerHTML='door.listen(<span class="hljs-string" style="color: rgb(224, 196, 108);">&#39;guardDone&#39;</span>, <span class="hljs-function"><span class="hljs-params" style="color: rgb(185, 185, 185);">()</span> =&gt;</span> <span class="hljs-built_in" style="color: rgb(224, 196, 108);">console</span>.log(guard.test(secretKnock)) }',fe=u(),ge=d("p"),ge.textContent="The test function will return true if the secretKnock is close to the knock your user has just performed.",me=u(),ke=d("p"),ke.textContent="In order to make a secret knock, you can create a recorder. It's almost exactly the same as a Guard:",be=u(),ve=d("pre"),ve.innerHTML='let door = <span class="hljs-built_in" style="color: rgb(224, 196, 108);">document</span>.querySelector(<span class="hljs-string" style="color: rgb(224, 196, 108);">&#39;#door&#39;</span>)\nlet recorder = Prohibition.getRecorder(door)\nrecorder.listen(<span class="hljs-string" style="color: rgb(224, 196, 108);">&#39;recordDone&#39;</span>, <span class="hljs-function"><span class="hljs-params" style="color: rgb(185, 185, 185);">(secretKnock)</span> =&gt;</span> <span class="hljs-built_in" style="color: rgb(224, 196, 108);">console</span>.log(secretKnock) }\nrecorder.start()',ye=u(),we=d("p"),we.textContent="You can paste those values right into an array or store them programatically.",xe=u(),$e=d("p"),$e.innerHTML='There are a few other events you can listen to: <span class="code svelte-1u11mpd">knock</span>, <span class="code svelte-1u11mpd">knockChanged</span>.',je=u(),Ce=d("h2"),Ce.textContent="What else?",Te=u(),_e=d("p"),_e.textContent='The "testing" function is very simple. It normalizes all the values and checks how close they are against the reference. Feel free to write your own machine learning powered detector.',p(o,"class","wrapper"),p(m,"id","room"),p(m,"class","svelte-1u11mpd"),p(v,"id","knob"),p(v,"class","svelte-1u11mpd"),p(w,"id","slat-container"),p(w,"class","svelte-1u11mpd"),p(b,"id","door"),p(b,"class",x="door-open "+t[0]+" svelte-1u11mpd"),p(j,"class","speech scram svelte-1u11mpd"),p(C,"class","speech ok svelte-1u11mpd"),p(g,"id","mask"),p(g,"class","svelte-1u11mpd"),p(f,"class","wrapper"),p(c,"id","door-container"),p(c,"class","svelte-1u11mpd"),p(E,"class","toggle-checkbox"),p(E,"type","checkbox"),p(K,"class","toggle-switch"),p(H,"class","toggle-label"),p(L,"class","toggle"),p(A,"id","visualization-wrapper"),p(A,"class","svelte-1u11mpd"),p(z,"id","recording-visualization-wrapper"),p(z,"class","svelte-1u11mpd"),p(P,"class","svelte-1u11mpd"),p(Q,"class","svelte-1u11mpd"),p(Z,"class","svelte-1u11mpd"),p(re,"class","hljs"),h(re,"display","block"),h(re,"overflow-x","auto"),h(re,"padding","0.5em"),h(re,"background","rgb(43, 43, 43) none repeat scroll 0% 0%"),h(re,"color","rgb(186, 186, 186)"),p(le,"class","hljs"),h(le,"display","block"),h(le,"overflow-x","auto"),h(le,"padding","0.5em"),h(le,"background","rgb(43, 43, 43) none repeat scroll 0% 0%"),h(le,"color","rgb(186, 186, 186)"),p(he,"class","hljs"),h(he,"display","block"),h(he,"overflow-x","auto"),h(he,"padding","0.5em"),h(he,"background","rgb(43, 43, 43) none repeat scroll 0% 0%"),h(he,"color","rgb(186, 186, 186)"),p(ve,"class","hljs"),h(ve,"display","block"),h(ve,"overflow-x","auto"),h(ve,"padding","0.5em"),h(ve,"background","rgb(43, 43, 43) none repeat scroll 0% 0%"),h(ve,"color","rgb(186, 186, 186)"),p(Ce,"class","svelte-1u11mpd"),p(_,"class","wrapper"),p(s,"class",Le=i(t[1])+" svelte-1u11mpd")},m(e,i){var l,d,u,p;!function(e,t,n){e.insertBefore(t,n||null)}(e,n,i),a(n,s),a(s,o),a(s,r),a(s,c),a(c,f),a(f,g),a(g,m),a(g,k),a(g,b),a(b,v),a(b,y),a(b,w),a(g,$),a(g,j),a(g,C),a(s,T),a(s,_),a(_,L),a(L,E),E.checked=t[2],a(L,M),a(L,K),a(L,F),a(L,H),a(_,S),a(_,A),a(_,D),a(_,z),a(_,I),a(_,P),a(_,O),a(_,q),a(_,W),a(_,G),a(_,B),a(_,N),a(_,Y),a(_,R),a(_,J),a(_,Q),a(_,U),a(_,V),a(_,X),a(_,Z),a(_,ee),a(_,te),a(_,ne),a(_,se),a(_,oe),a(_,re),a(_,ce),a(_,ie),a(_,ae),a(_,le),a(_,de),a(_,ue),a(_,pe),a(_,he),a(_,fe),a(_,ge),a(_,me),a(_,ke),a(_,be),a(_,ve),a(_,ye),a(_,we),a(_,xe),a(_,$e),a(_,je),a(_,Ce),a(_,Te),a(_,_e),Ee||(l=E,d="change",u=t[4],l.addEventListener(d,u,p),Me=()=>l.removeEventListener(d,u,p),Ee=!0)},p(e,[t]){1&t&&x!==(x="door-open "+e[0]+" svelte-1u11mpd")&&p(b,"class",x),4&t&&(E.checked=e[2]),2&t&&Le!==(Le=i(e[1])+" svelte-1u11mpd")&&p(s,"class",Le)},i:e,o:e,d(e){e&&l(n),Ee=!1,Me()}}}function G(e,t){console.log(e,t);let n={scanning:{events:{knock:"waiting",recording:"recording"}},waiting:{events:{success:"accepted",failure:"rejected"}},rejected:{events:{wait:"scanning",recording:"recording"}},recording:{events:{"recording-cancel":"scanning","recording-finish":"scanning"}},accepted:{events:{recording:"recording"}}};return t in n[e].events?n[e].events[t]:e}function B(t,n,s){let o,i,a,l,d,u,p="",h="scanning",f=[2452,2889,3177,3346,3782,4697,5163],g=function(t,n=e){let s;const o=new Set;function c(e){if(r(t,e)&&(t=e,s)){const e=!K.length;for(const e of o)e[1](),K.push(e,t);if(e){for(let e=0;e<K.length;e+=2)K[e][0](K[e+1]);K.length=0}}}return{set:c,update:function(e){c(e(t))},subscribe:function(r,i=e){const a=[r,i];return o.add(a),1===o.size&&(s=n(c)||e),r(t),()=>{o.delete(a),0===o.size&&(s(),s=null)}}}}(!1);function k(e){e.preventDefault(),["scanning","waiting"].includes(h)&&s(0,p="knocking")}function b(e){e.preventDefault(),["scanning","waiting"].includes(h)&&s(0,p="")}return c(t,g,(e=>s(2,o=e))),m((()=>{d=q(document.getElementById("recorded-knock")),d.drawContainer(),d.updateKnock(f),u=q(document.getElementById("recording-knock")),u.drawContainer(),i=document.querySelector("#door"),a=O(i),l=P(i),a.listen("knock",(function(){s(1,h=G(h,"knock"))})),a.listen("guardDone",(function(){i.addEventListener("animationend",(()=>{s(1,h=G(h,"wait")),a.start()}));let e="";e=a.test(f)?"success":"failure",s(1,h=G(h,e))})),a.start(),l.listen("recordDone",(function(){var e;d.updateKnock(l.knock),u.updateKnock([]),o=!1,e=o,g.set(e)})),l.listen("knockChanged",(function(e){u.updateKnock(e)})),i.addEventListener("ontouchstart"in window?"touchstart":"mousedown",k),i.addEventListener("ontouchend"in window?"touchend":"mouseup",b)})),g.subscribe((()=>{s(1,h=G(h,o?"recording":"recording-cancel")),o&&(a.stop(),l.start())})),window.getState=function(){console.log(h)},[p,h,o,g,function(){o=this.checked,g.set(o)}]}return new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),M(this,e,B,W,r,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
